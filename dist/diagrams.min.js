"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){var b={},c=b;!function(){c.utils={},c.utils.d3DefaultReturnFn=function(a,b,c){return a=a.split("."),function(d){var e=_.reduce(a,function(a,b){return a[b]},d);return b||c?b+e+c:e}},c.utils.applySimpleTransform=function(a){a.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})},c.utils.positionFn=function(a,b){return b=b||0,c.utils.d3DefaultReturnFn(a,0,b)},c.utils.textFn=function(a,b,d){return b=b||"",d=d||"",c.utils.d3DefaultReturnFn(a,b,d)},c.utils.runIfReady=function(a){"complete"===document.readyState?a():window.onload=a},c.utils.replaceCodeFragmentOfText=function(a,b){var c=/``([\s\S]*?)``([\s\S]*?)``/g,d=a.match(c);return a.replace(c,function(a,c,e){return b(a,c,e,d)})},c.utils.formatTextFragment=function(a){var b=["strong","code","pre","br","span","p"],d=function e(b,c){var d=_.partial(e,b),f=["<"+c+"(.*?)>","<"+c+"$1>",c+"DIAGSA(.*?)DIAGSB"+c+"DIAGSC",c+"DIAGSA$1DIAGSB"+c+"DIAGSC"],g="</"+c+">",h=c+"ENDREPLACEDDIAGRAMS",i=[g,g,h,h],j=function(b,c){a=a.replace(new RegExp(b,"g"),c)};_.isArray(c)?_.each(c,d):_.each([f,i],function(a){"encode"===b?j(a[0],a[3]):"decode"===b&&j(a[2],a[1])})};return a=c.utils.replaceCodeFragmentOfText(a,function(a,b,c,d){var e=a===_.last(d);return"<pre"+(e?' class="last-code-block" ':"")+"><code>"+hljs.highlight(b,c).value+"</pre></code>"}),d("encode",b),a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;"),d("decode",b),a},c.utils.codeBlockOfLanguageFn=function(a,b){return b=b||"",function(c,d,e){return e===!0&&(c=b+" ...\n"+c+"\n"+b+" ..."),_.isString(d)&&(c=b+" @"+d+"\n"+c),"``"+a+"``"+c+"``"}},c.utils.wrapInParagraph=function(a){return"<p>"+a+"</p>"},c.utils.composeWithEventEmitter=function(a){var b=[],c=function(a){return"$"+a};a.prototype.emit=function(a,d){var e=c(a);b[e]||(b[e]=new Rx.Subject),b[e].onNext(d)},a.prototype.listen=function(a,d){var e=c(a);return b[e]||(b[e]=new Rx.Subject),b[e].subscribe(d)},a.prototype.dispose=function(){var a=b;for(var c in a)({}).hasOwnProperty.call(a,c)&&a[c].dispose();b={}}},c.utils.createAnEventEmitter=function(){var a=function(){};return c.utils.composeWithEventEmitter(a),new a},c.utils.generateATextDescriptionStr=function(a,b){return"<strong>"+a+"</strong>"+(b?"<br>"+b:"")},c.utils.formatShortDescription=function(a){return a=a.replace(/<p>/g,""),a=a.replace(/<br>/g," "),a=a.replace(/<\/p>/g,". "),a=c.utils.replaceCodeFragmentOfText(a,function(b,c,d){return b===a&&/\n/.test(b)===!1?d:" <CODE...>"})},c.utils.dataFromGeneralToSpecificForATreeStructureType=function(a){var b,c=!1,d={},e={},f=function(){var e,f={},g=function h(g){var i,j,k;return e.indexOf(g)>-1?void(c=!0):(e.push(g),_.isUndefined(f[g.id])===!1?i=f[g.id]:(i=_.where(a.connections,{from:g.id}),f[g.id]=i),void(0===i.length?b?b.id!==g.id&&(c=!0):b=g:1===i.length?(j=i[0].to,_.isUndefined(d[j])===!1?k=d[j]:(k=_.where(a.items,{id:j})[0],d[j]=k),h(k)):c=!0))};_.each(a.items,function(a){c===!1&&(e=[],d[a.id]=a,g(a))})},g=function h(b,c){var e,f;b.id=c.id,e=c.name,c.description&&(e+=": "+c.description),b.text=e,f=_.where(a.connections,{to:c.id}),f.length>0&&(b.items=[],_.each(f,function(a){b.items.push({}),h(_.last(b.items),d[a.from])}))};return f(),c?(alert("The data structure is not suitable for this diagram"),[]):(g(e,b),e)},c.utils.getUrlParams=function(){for(var a={},b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("undefined"==typeof a[e[0]])a[e[0]]=decodeURIComponent(e[1]);else if("string"==typeof a[e[0]]){var f=[a[e[0]],decodeURIComponent(e[1])];a[e[0]]=f}else a[e[0]].push(decodeURIComponent(e[1]))}return a}}(),function(){var a={},b=0;c.diagramsRegistry=[],c.Diagram=function(){function d(b){_classCallCheck(this,d);var c=this,e=Object.getPrototypeOf(c);c.name=b.name,c._configuration=b.configuration||{},_.each(Object.keys(b.helpers),function(a){_.isFunction(b.helpers[a])&&(b.helpers[a]=_.bind(b.helpers[a],c))}),_.merge(c._configuration,a),_.each(Object.keys(c._configuration),function(a){c.configCheckingLocalStorage(a,c._configuration[a])}),_.defaults(e,b.helpers),c.register()}return _createClass(d,null,[{key:"convertDiagram",value:function(a,b){var d,e,f=c.Diagram.getRegistryItemWithCreationId(a),g=f.data.slice(1);d=f.diagram.dataFromSpecificToGeneral.apply({},g),e=c[b].dataFromGeneralToSpecific.apply({},[d]),c.events.emit("diagram-to-transform",f.diagram),c.Diagram.removePreviousDiagrams(),c[b].apply(f.diagram,[e])}},{key:"removePreviousDiagrams",value:function(){d3.select("svg").remove(),d3.selectAll("input.diagrams-diagram-button").remove()}},{key:"addDivBeforeSvg",value:function(){var a=d3.select("body"),b=a.insert("div","svg");return b.appendButtonToDiv=function(a,c,d){b.append("input").attr({type:"button","class":a+" diagrams-diagram-button btn btn-default",value:c,onclick:d})},b}},{key:"getRegistryItemWithCreationId",value:function(a){var b=_.where(c.diagramsRegistry,{id:a});return 1===b.length?b[0]:null}},{key:"getDataWithCreationId",value:function(a){var b=c.Diagram.getRegistryItemWithCreationId(a);return b?b.data:null}}]),_createClass(d,[{key:"addMouseListenersToEl",value:function(a,b,c){var d=this,e=function(b,e){e=e||b,a.on(b,function(){d.emit(e,f),c&&c[b]&&c[b](f)})},f={el:a,data:b};e("mouseleave"),e("mouseenter"),e("click","itemclick")}},{key:"config",value:function(a,b){var c,d=arguments.length,e=typeof a;if(0===d)return this._configuration;if(1===d){if(_.isFunction(e))c=a();else if(_.isString(a))c=a;else if(_.isObject(a)){for(var f in a)this.config(f,a[f]);return a}return this._configuration[c]}return 2===d?(this._configuration[a]=b,_.isObject(b)?this.setToLocalStorage(a,b.value):this.setToLocalStorage(a,b),this.emit("configuration-changed",{key:a,value:b}),b):void 0}},{key:"configCheckingLocalStorage",value:function(a,b){var c=this,d=c.getFromLocalStorage(a,b);c.config(a,d)}},{key:"generateLocalStorageKeyPreffix",value:function(a){return"diagramsjs-"+a}},{key:"getFromLocalStorage",value:function(a,b){var c=this,d=function(b){var d=localStorage.getItem(c.generateLocalStorageKeyPreffix(a))||b;return"false"===d?d=!1:"true"===d&&(d=!0),d},e=b;return localStorage&&localStorage.getItem&&(_.isObject(e)?(e.value=d(e.value),e.type&&(e.value=e.type(e.value))):e=d(e)),e}},{key:"setToLocalStorage",value:function(a,b){var c=this;return localStorage&&localStorage.setItem?localStorage.setItem(c.generateLocalStorageKeyPreffix(a),b):void 0}},{key:"generateEmptyRelationships",value:function(a){a.relationships={},a.relationships.dependants=[],a.relationships.dependencies=[]}},{key:"addDependantRelationship",value:function(a,b,c){a.relationships.dependants.push(this.generateRelationship(b,c))}},{key:"addSelfRelationship",value:function(a,b,c){a.relationships.self=this.generateRelationship(b,c)}},{key:"addDependencyRelationship",value:function(a,b,c){a.relationships.dependencies.push(this.generateRelationship(b,c))}},{key:"generateRelationship",value:function(a,b){return{el:a,data:b}}},{key:"getAllRelatedItemsOfItem",value:function(a,b){var c,d=this,e=[],f=function g(a,c){_.each(a.relationships[b],function(b){100>c&&e.indexOf(b)<0&&b.data!==a&&(e.push(b),g(b.data,c+1))})};return b?(f(a,0),e):(c={},_.each(["dependants","dependencies"],function(b){c[b]=d.getAllRelatedItemsOfItem(a,b)}),c)}},{key:"markRelatedItems",value:function(a){var b,c,d=this;d.markRelatedFn&&a.relationships&&(b=d.getAllRelatedItemsOfItem(a,"dependants"),c=d.getAllRelatedItemsOfItem(a,"dependencies"),_.each([b,c],function(a){_.each(a,d.markRelatedFn)}),d.markRelatedFn(a.relationships.self))}},{key:"register",value:function(){var a=this;c.diagramTypes=c.diagramTypes||[],c.diagramTypes.push(a.name),c[a.name]=function(){var d=Array.prototype.slice.call(arguments);c.utils.runIfReady(function(){b++,c.diagramsRegistry.push({diagram:a,data:d,id:b}),a.addConversionButtons(b),d.unshift(b),a.create.apply(a,d),c.events.emit("diagram-created",a)})},_.defaults(c[a.name],Object.getPrototypeOf(a))}},{key:"addConversionButtons",value:function(a){var b,d=this,e=c.Diagram.addDivBeforeSvg();_.each(c.diagramTypes,function(c){c!==d.name&&(b="diagrams.Diagram.convertDiagram("+a+", '"+c+"')",e.appendButtonToDiv("diagrams-box-conversion-button","To "+c+" diagram",b))})}}]),d}(),c.utils.composeWithEventEmitter(c.Diagram)}(),function(){c.events=c.utils.createAnEventEmitter()}(),function(){c.shapes={},c.shapes.hexagon=function(a){var b,c,d,e=a.height/2,f=a.width/2,g=a.widthPercent?(1-a.widthPercent/100)*a.width:(a.width-a.height)/2,h="";return b=a.center||[f,e],c=b[0],d=b[1],h+="M"+(c-f)+","+d,h+="L"+(c-f+g)+","+(d+e),h+="L"+(c+f-g)+","+(d+e),h+="L"+(c+f)+","+d,h+="L"+(c+f-g)+","+(d-e),h+="L"+(c-f+g)+","+(d-e),h+="Z"}}(),function(){c.shared={get:function(a){return c.shared.throwIfSharedMethodAlreadyExists(a),c.shared[a]},set:function(a){c.shared.throwIfSharedMethodAlreadyExists(a),c.shared=_.defaults(c.shared,a)},getWithStartingBreakLine:function(){return"<br>"+c.shared.get.apply(c.shared,arguments)},throwIfSharedMethodAlreadyExists:function(b){var d;if(_.isObject(b))d=Object.keys(b),_.each(d,c.shared.throwIfSharedMethodAlreadyExists);else if(_.isString(b)&&c.shared[a].indexOf(b)>0)throw new Error("Reserved keyword: "+b)}};var a="builtInMethods";c.shared[a]=Object.keys(c.shared),c.shared[a].push(a)}(),function(){c.svg={},c.svg.addVerticalGradientFilter=function(a,b,c){var d=a.append("defs"),e=d.append("linearGradient").attr({id:b,x1:"0%",y1:"0%",x2:"0%",y2:"100%"});e.append("stop").attr("offset","0%").style({"stop-color":c[0],"stop-opacity":1}),e.append("stop").attr("offset","100%").style({"stop-color":c[1],"stop-opacity":1})},c.svg.addFilterColor=function(a,b,c,d,e){var f=b.append("defs"),g=f.append("filter").attr({id:"diagrams-drop-shadow-"+a});e&&g.attr({width:"500%",height:"500%",x:"-200%",y:"-200%"}),g.append("feOffset").attr({result:"offOut","in":"SourceGraphic",dx:.5,dy:.5}),g.append("feGaussianBlur").attr({result:"blurOut","in":"offOut",stdDeviation:c}),g.append("feBlend").attr({"in":"SourceGraphic",in2:"blurOut",mode:"normal"}),g.append("feComponentTransfer").append("feFuncA").attr({type:"linear",slope:d})},c.svg.generateSvg=function(a){var b=document.body.getBoundingClientRect();return d3.select("body").append("svg").attr({width:b.width-40,height:4e3}).style(a)},c.svg.updateHeigthOfElWithOtherEl=function(a,b,c){a.attr({height:b[0][0].getBoundingClientRect().height+(c||0)})},c.svg.textEllipsis=function(a){return function(){for(var b=d3.select(this),c=b.node().getComputedTextLength(),d=b.text();c>a&&d.length>0;)d=d.slice(0,-4),b.text(d+"..."),c=b.node().getComputedTextLength()}}}(),function(){var a,b={generateDefinitionWithSharedGet:function(){var b,d,e=arguments[0];return d=arguments.length>1?arguments[1]:"",b=d+e.split("(")[0],a.generateDefinition(e,c.shared.get(b))},addButtons:function(a){var b=c.Diagram.addDivBeforeSvg();b.appendButtonToDiv("diagrams-box-collapse-all-button","Collapse all","diagrams.box.collapseAll("+a+")"),b.appendButtonToDiv("diagrams-box-expand-all-button","Expand all","diagrams.box.expandAll("+a+")")},expandOrCollapseAll:function(a,d){var e=function g(a){_.each(a,function(a){a.hasOwnProperty("collapsed")&&b[d+"Item"](a),a.items&&g(a.items),a.collapsedItems&&g(a.collapsedItems)})},f=c.Diagram.getDataWithCreationId(a)[1];e(f.body),b.addBodyItemsAndUpdateHeights()},collapseAll:function(a){b.expandOrCollapseAll(a,"collapse")},expandAll:function(a){b.expandOrCollapseAll(a,"expand")},convertToGraph:function(a){console.log("origConf",a)},convertToLayer:function(a){var b=function f(a){_.each(a,function(b,c){_.isString(b)&&(b=a[c]={text:b}),b.description&&(b.text+=": "+b.description),b.items?f(b.items):b.items=[]})},d=function(){var a=d3.select("svg");d3.selectAll("input.diagrams-diagram-button").remove(),a.remove(),c.layer(e)},e=[];e.push({text:a.name,items:a.body}),b(e[0].items),d()},collapseItem:function(a){a.items.length>0&&(a.collapsedItems=a.items,a.collapsed=!0,a.items=[])},expandItem:function(a){a.collapsedItems&&(a.items=a.collapsedItems,delete a.collapsedItems,a.collapsed=!1)},generateItem:function(a,b,c,d){var e={isLink:!1};return c=c||{},{text:a,description:b||null,options:_.defaults(c,e),items:d||[]}},generateContainer:function(a,c,d){return _.isArray(c)&&(d=c,c=null),b.generateItem(a,c,null,d)},generateLink:function(a,c){return b.generateItem(a,c,{isLink:!0})},generateDefinition:function(a,c){return b.generateItem(a,c)},dataFromSpecificToGeneral:function(a){var b=-1,c=[],d=[],e=function f(a,e){_.each(a,function(a){var g={name:a.text,description:a.description,graphsData:{box:{options:a.options}},id:++b};c.push(g),e?d.push({from:g.id,to:e.id}):d.push({from:g.id,to:0}),a.items&&a.items.length>0&&f(a.items,g)})};return c.push({name:a.name,id:++b}),e(a.body),{items:c,connections:d}},dataFromGeneralToSpecific:function(a){var b=c.utils.dataFromGeneralToSpecificForATreeStructureType(a);return b.name=b.text,b.body=b.items,delete b.items,delete b.text,b}},d=0;new(a=function(a){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,a),_createClass(e,[{key:"create",value:function(a,e,f){var g,h,i,j=this,k=c.svg.generateSvg(),l=k.attr("width")-40,m=50,n=k.append("g").attr({transform:"translate(20, 20)","class":"box-diagram"}),o=n.append("g"),p=30,q=35,r=c.utils.getUrlParams(),s=function(a,c){if(c.items.length>0||c.collapsedItems){var d=a.select("text"),e=d.attr("y"),f=d.attr("x"),g=a.append("g").attr({"class":"collapsible-trigger"}),h=function(){b.collapseItem(c),b.addBodyItemsAndUpdateHeights()},i=function(){b.expandItem(c),b.addBodyItemsAndUpdateHeights()},j=g.append("text").attr({y:Number(e)+5,x:Number(f)-20}),k=function(){j.text("-").attr("class","minus"),g.on("click",h)},l=function(){j.text("+").attr({"class":"plus",y:e}),g.on("click",i)};_.isUndefined(c.collapsed)?(c.collapsed=!1,k()):c.collapsed===!0?l():c.collapsed===!1&&k()}},t=function v(a,f,i){var l,m,n,o,r;a=a||e.body,f=f||g,i=i||1,a===e.body&&(h=1),_.each(a,function(e,g){var t;t="diagrams-box-text-"+d++,_.isString(e)&&(e=b.generateItem(e),a[g]=e),e.items=e.items||[],e.items.length>0?(l=f.append("g"),r=c.utils.formatShortDescription(e.text),e.items&&e.items.length>0&&(r+=":"),e.description?(e.fullText=c.utils.generateATextDescriptionStr(r,e.description),r+=" (...)"):e.fullText=e.text,m=l.append("text").text(r).attr({x:q*i,y:p*++h,id:t}),v(e.items,l,i+1)):e.options&&e.options.isLink===!0?(l=f.append("svg:a").attr("xlink:href",e.description),m=l.append("text").text(c.utils.formatShortDescription(e.text)).attr({id:t,x:q*i,y:p*++h,fill:"#3962B8"}),e.fullText=e.text+" ("+e.description+")"):(l=f.append("g").attr({id:t}),m=l.append("text").text(c.utils.formatShortDescription(e.text)).attr({x:q*i,y:p*++h}).style({"font-weight":"bold"}),e.description&&(n=m[0][0].getBoundingClientRect().width,o=k[0][0].getBoundingClientRect().width-n-q*i-30,l.append("text").text("- "+c.utils.formatShortDescription(e.description)).attr({x:q*i+n+5,y:p*h-1}).each(c.svg.textEllipsis(o))),e.fullText=c.utils.generateATextDescriptionStr(e.text,e.description)),s(l,e),e.textG=l,j.addMouseListenersToEl(m,e)})},u=function(a){var b,c,d=null,f=function g(b){_.each(b,function(b){_.isNull(d)&&(_.isString(b.text)&&b.text.indexOf(a)>-1?d=b:b.items&&g(b.items))})};f(e.body),d&&(b=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),c=d.textG[0][0].getBoundingClientRect().top,_.defer(function(){window.scrollTo(0,c+b)})),console.log("targetFound",d)};f=f||{},b.addBodyItemsAndUpdateHeights=_.bind(function(){var a=this,b=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);k.attr("height",10),g&&g.remove(),g=n.append("g").attr({transform:"translate(0, "+m+")"}),i=g.append("rect").attr({width:l,stroke:"#000",fill:"#fff"}).style({filter:"url(#diagrams-drop-shadow-box)"}),t(),a.setRelationships(e.body),c.svg.updateHeigthOfElWithOtherEl(k,n,50),c.svg.updateHeigthOfElWithOtherEl(i,n,25-m),window.scrollTo(0,b),a.emit("items-rendered")},this),c.svg.addFilterColor("box",k,3,4),o.append("rect").attr({height:m,width:l,stroke:"#000",fill:"#fff"}).style({filter:"url(#diagrams-drop-shadow-box)"}),o.append("text").attr({x:l/2,y:30}).text(e.name).style({"font-weight":"bold","text-anchor":"middle"}),d3.select(document.body).style("opacity",0),b.addBodyItemsAndUpdateHeights(),f.allCollapsed===!0&&b.collapseAll(a),b.addButtons(a),d3.select(document.body).style("opacity",1),r.target&&u(r.target)}},{key:"setRelationships",value:function(a,b){var c=this;_.each(a,function(a){c.generateEmptyRelationships(a),b&&(c.addDependantRelationship(b,a.textG,a),c.addDependencyRelationship(a,b.textG,b)),a.items&&a.items.length>0&&c.setRelationships(a.items,a)})}}]),e}(c.Diagram))({name:"box",helpers:b})}(),function(){var a,d,e,f={},g="Show connections selectively",h="dia graph zoom",i={"private":!0,type:Number,value:1},j=c.utils.positionFn,k=c.utils.textFn,e={generateConnectionWithText:function(a,c){return _.isArray(a)&&_.isArray(a[0])?_.map(a,function(a){return e.generateConnectionWithText.apply({},a)}):(_.isString(a)?a=a.split(" ").map(Number):_.isNumber(a)&&(a=[a]),b.graph.mergeWithDefaultConnection({nodesIds:a,text:c}))},connectionFnFactory:function(a,b,c){return function(){var d=a.apply({},arguments),e=function(a){return a[b]=c,d};return _.isArray(d)?_.map(d,e):e(d)}},generateNodeOptions:function(a){var b,c={};return _.isString(a)?e.generateNodeOptions(a.split(" ")):_.isArray(a)?(_.each(a,function(a){"s-"===a.substr(0,2)?(b=a.substr(2,a.length-2),"t"===b?c.shape="triangle":"s"===b?c.shape="square":c.shape="circle"):"b"===a?c.bold=!0:"l~"===a.substr(0,2)&&(c.linkToUrl=a.substr(2,a.length-2))}),c):void 0},getDefaultConnection:function(){var a={direction:"out",symbol:"arrow",line:"plain"};return _.cloneDeep(a)},mergeWithDefaultConnection:function(a){return _.defaults(a,e.getDefaultConnection())},generateNodeWithTargetLink:function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return _.isUndefined(c[3])?c[3]="":c[3]+=" ",c[3]+="l~"+a+"?target="+encodeURIComponent(b),e.generateNode.apply({},c)}},generateNodeWithTextAsTargetLink:function(a){return function(){return b.graph.generateNodeWithTargetLink(a,arguments[0]).apply({},arguments)}},generateNode:function(){var a,b={name:arguments[0]},c=function(a){b.connections.push(e.mergeWithDefaultConnection({nodesIds:[a]}))},d=function f(a){_.isArray(a)?_.each(a,f):_.isNumber(a)?f({nodesIds:[a]}):_.isObject(a)&&(e.mergeWithDefaultConnection(a),b.connections.push(a))};return arguments.length>1&&(a=arguments[1],b.connections=[],_.isString(a)?(a=a.split(" ").map(Number),a.length>0&&(b.id=a[0]),a.length>1&&_.each(a,function(a,b){b>0&&d(a)})):_.isArray(a)?(b.id=a[0],a=a.slice(1),_.each(a,function(a){_.isNumber(a)?c(a):d(a)})):_.isNumber(a)&&(b.id=a),arguments.length>2&&(b.description=arguments[2]),arguments.length>3&&(b.options=e.generateNodeOptions(arguments[3]))),b},generateNodeWithSharedGet:function(){var a,b,d,f=arguments[0];return b=arguments.length>2?arguments[2]:"",a=b+f.split("(")[0],d=arguments.length>3?arguments[3]:null,e.generateNode(f,arguments[1],c.shared.get(a),d)},generateFnNodeWithSharedGetAndBoldIfFile:function(a){return function(){var b="",c="";return arguments[0].split("@")[0]===a&&(b="b"),arguments.length>2&&(c=arguments[2]),arguments.length>3&&(b=arguments[3]+" "+b),e.generateNodeWithSharedGet(arguments[0],arguments[1],c,b)}},dataFromGeneralToSpecific:function(a){var b,c=[],d={};return _.each(a.items,function(a,b){c.push({name:a.name,id:a.id,description:a.description}),d[a.id]=b}),_.each(a.connections,function(a){b=c[d[a.to]],b.connections=b.connections||[],b.connections.push({direction:"in",nodesIds:[a.from]})}),c},dataFromSpecificToGeneral:function(a){var b,c=[],d=[];return _.each(a,function(a){c.push({id:a.id,name:a.name,description:a.description}),_.each(a.connections,function(c){_.each(c.nodesIds,function(e){b={},"out"===c.direction?(b.from=a.id,b.to=e):"in"===c.direction&&(b.from=e,b.to=a.id),d.push(b)})})}),{items:c,connections:d}},doWithMinIdAndMaxIdOfLinkNodes:function(a,b){var c=function(a){return _.isNumber(a)?a:a.index},d=[c(a.source),c(a.target)],e=_.min(d),f=_.max(d);return b(e,f)},updateLinksNumberMapWithLink:function(a){e.doWithMinIdAndMaxIdOfLinkNodes(a,function(a,b){_.isUndefined(f[a])&&(f[a]={}),_.isUndefined(f[a][b])?f[a][b]=1:f[a][b]+=1})},getLinksNumberMapItemWithLink:function(a){return e.doWithMinIdAndMaxIdOfLinkNodes(a,function(a,b){return f[a][b]})}};new(d=function(a){function b(){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return _inherits(b,a),_createClass(b,[{key:"create",value:function(a,b,d){var f,l,m,n,o,p,q,r,s,t,u,v=this,w=Math.max(document.documentElement.clientHeight,window.innerHeight||0),x=c.svg.generateSvg(),y=x.append("g"),z=w-250,A=x.attr("width"),B=function(){var a=function(a){m.select("path."+a).attr("d",function(a){var b=e.getLinksNumberMapItemWithLink(a),c=a.data.linkIndex,d=a.target.x-a.source.x,f=a.target.y-a.source.y,g=3.5*Math.sqrt(d*d+f*f)*((c+1)/(3*b));return"M"+a.source.x+","+a.source.y+"A"+g+","+g+" 0 0,1 "+a.target.x+","+a.target.y})};_.each(["link-path","link-path-outer"],a),o.each(function(a){"circle"===a.shape?o.select("circle").attr("cx",j("x")).attr("cy",j("y")):("triangle"===a.shape?s=o.select("path.triangle"):"square"===a.shape&&(s=o.select("path.square")),c.utils.applySimpleTransform(s))}),o.select("text").attr("x",j("x")).attr("y",j("y",-20))},C=function(){var a,c,f,g,h,i=_.reduce(b,function(a,b){var c=b.id||0;return a>c?a:c},0),j={},k={},l=d3.scale.category10();u={links:[],nodes:[]},t=[],_.each(b,function(b,d){a=_.isUndefined(b.id)?i++:b.id,c=l(d),f=b.options||{},u.nodes.push({name:b.name,id:a,connections:b.connections||[],description:b.description||null,color:c,shape:f.shape||"circle",linkToUrl:f.linkToUrl||null,bold:f.bold||!1}),j[a]={index:d},_.isArray(b.connections)&&b.connections.length>0&&(j[a].color=c,t.push({id:a,color:c}))}),_.each(u.nodes,function(a,b){a.connections.length>0&&_.each(a.connections,function(c){_.each(c.nodesIds,function(f){g=j[f],g&&(d.hideNodesWithoutLinks&&(k[g.index]=!0,k[b]=!0),h={},"out"===c.direction?(h.source=b,h.target=g.index):(h.source=g.index,h.target=b),h.data=c,h.color=j[a.id].color,e.updateLinksNumberMapWithLink(h),h.data.linkIndex=e.getLinksNumberMapItemWithLink(h)-1,h.data.text&&(h.data.fullText=h.data.text),u.links.push(h))})})}),d.hideNodesWithoutLinks===!0&&_.each(u.nodes,function(a,b){k[b]!==!0&&(a.hidden=!0)})},D=function(a,b){b=b||1,y.attr("transform","translate("+a+")scale("+b+")"),i.value=b,v.config(h,i)},E=function(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0),f.start()},F=function(a){d3.select(this).attr("cx",a.x=d3.event.x).attr("cy",a.y=d3.event.y)},G=function(){d3.select(this).classed("dragging",!1)},H=function(){_.each(u.nodes,v.generateEmptyRelationships,v),_.each(u.nodes,function(a){v.addSelfRelationship(a,a.shapeEl,a)}),_.each(u.links,function(a){v.addDependencyRelationship(a.source,a.target.shapeEl,a.target),v.addDependantRelationship(a.target,a.source.shapeEl,a.source)})},I=function(){return y.selectAll(".link")},J=function(){return I().filter(function(a){return a.data.hasOwnProperty("shyIsHiding")})},K=function(a,b){var c,d,e="show"===a,f="hide"===a,g=b.data,h=J(),i=I().filter(function(a){return a.source.id===g.id||a.target.id===g.id}),j=function(a,b){a.classed("shy-link-hidden",!b),a.classed("shy-link-showed",b)},k=function(a){j(a,!1),a.each(function(a){delete a.data.shyIsHiding})},l=function m(){setTimeout(function(){c=!0,d=!0,i.each(function(a){c=c&&a.data.shyIsHiding,a.data.shyIsHidingChanged&&(d=!1,delete a.data.shyIsHidingChanged)}),c&&d?k(i):m()},1e3)};0===h[0].length?e?j(i,!0):f&&(i.each(function(a){a.data.shyIsHiding=!0}),l()):e?h.each(function(a,b){0===b&&(a.data.shyIsHiding=!1)}):f&&L(!0,h.data()[0])},L=function(a,b){var c;v.config(g)&&(a===!1?b.data.shyIsHiding=a:a===!0&&(c=J(),c.each(function(a){a.data.shyIsHiding=!0})),b.data.shyIsHidingChanged=!0)};v.markRelatedFn=function(a){a.el.style("stroke-width","10px")},v.unmarkAllItems=function(){_.each(u.nodes,function(a){a.shapeEl.style("stroke-width","1px")})},d=d||{},C(),x.attr({height:z,"class":"graph-diagram"}),p=d3.behavior.zoom().scaleExtent([.1,10]).on("zoom",function(){D(d3.event.translate,d3.event.scale)}),x.call(p),p.translate([100,100]).scale(v.config(h).value),D(p.translate(),p.scale()),f=d3.layout.force().size([A,z]).charge(d.charge||-1e4).linkDistance(d.linkDistance||140).on("tick",B),l=d3.behavior.drag().origin(function(a){return a}).on("dragstart",E).on("drag",F).on("dragend",G),f.nodes(u.nodes).links(u.links).start(),y.append("svg:defs").selectAll("marker").data(t).enter().append("svg:marker").attr({id:k("id","arrow-head-"),"class":"arrow-head",fill:k("color"),viewBox:"0 -5 10 10",refX:19,refY:-1.5,markerWidth:8,markerHeight:8,orient:"auto"}).append("svg:path").attr("d","M0,-5L10,0L0,5"),m=y.selectAll(".link").data(u.links).enter().append("g").attr("class",function(){var a="link";return v.config(g)&&(a+=" shy-link shy-link-hidden"),a}),m.append("svg:path").attr({"class":"link-path","marker-end":function(a){var b="out"===a.data.direction?"source":"target";return"url(#arrow-head-"+a[b].id+")"}}).style({stroke:k("color"),"stroke-dasharray":function(a){return"plain"===a.data.line?null:"dotted"===a.data.line?"5,5":void 0}}),n=m.append("g"),n.append("svg:path").attr("class","link-path-outer"),n.each(function(a){v.addMouseListenersToEl(d3.select(this),a.data,{mouseenter:function(a){L(!1,a)},mouseleave:function(a){L(!0,a)}})}),o=y.selectAll(".node").data(u.nodes).enter().append("g").attr({"class":function(a){var b="node";return a.hidden===!0&&(b+=" node-hidden"),b},id:k("id","node-")}),o.each(function(a){var b="";q=d3.select(this),a.fullText=c.utils.generateATextDescriptionStr(a.name,a.description),"circle"===a.shape?s=q.append("circle").attr({r:12,fill:k("color")}):(r=d3.svg.symbol().size(750),s=q.append("path"),"triangle"===a.shape?(r=r.type("triangle-up"),b+=" triangle"):"square"===a.shape&&(r=r.type("square"),b+=" square"),s=s.attr({d:r,fill:k("color")}),c.utils.applySimpleTransform(s)),s.call(l),b+=a.bold===!0?" bold":" thin",s.attr("class",b),a.shapeEl=s,v.addMouseListenersToEl(s,a,{mouseenter:function(a){v.config(g)&&K("show",a)},mouseleave:function(a){v.config(g)&&K("hide",a)},click:function(a){a.data.linkToUrl&&window.open(a.data.linkToUrl)}})}),o.append("text").text(k("name")),H(),v.listen("configuration-changed",function(d){d.key===g&&(c.Diagram.removePreviousDiagrams(),v.create(a,b,d))})}}]),b}(c.Diagram))({name:"graph",helpers:e,configuration:(a={},_defineProperty(a,g,!0),_defineProperty(a,h,i),a)})}(),function(){var a,d=0,e=c.utils.textFn,f={ids:0,Grid:function(){function a(b){_classCallCheck(this,a),this.position={x:0,y:0},this.width=b,this.cells=[]}return _createClass(a,[{key:"addItemAtNewRow",value:function(a){var b=0;for(this.position.x=0;1e3>b&&(this.position.y+=1,!this.itemFitsAtCurrentPos(a)););this.addItemAtCurrentPos(a)}},{key:"addItemAtCurrentPos",value:function(a){this.addItemAtPos(a,this.position)}},{key:"createRowIfNecessary",value:function(a){_.isUndefined(this.cells[a])&&(this.cells[a]=[])}},{key:"addItemAtPos",value:function(a,b){var c;a.x=b.x,a.y=b.y;for(var d=0;d<a.height;d++){this.createRowIfNecessary(d+b.y),c=this.cells[d+b.y];for(var e=0;e<a.width;e++)c[e+b.x]=!0}this.updatePosition()}},{key:"updatePosition",value:function(){for(var a=0;1e3>a;){if(this.position.x+=1,this.position.x===this.width)this.position.x=-1,this.position.y+=1,this.createRowIfNecessary(this.position.y);else if(this.cells[this.position.y][this.position.x]!==!0)break;a++}}},{key:"itemFitsAtPos",value:function(a,b){for(var c,d=0;d<a.height;d++){if(c=this.cells[d+b.y],_.isUndefined(c))return!0;for(var e=0;e<a.width;e++){if(c[e+b.x]===!0)return!1;if(e+b.x+1>this.width)return!1}}return!0}},{key:"itemFitsAtCurrentPos",value:function(a){return this.itemFitsAtPos(a,this.position)}},{key:"movePositionToNextRow",value:function(){this.position.y++,this.position.x=0,this.createRowIfNecessary(this.position.y)}},{key:"lastRowIsEmpty",value:function(){for(var a=this.cells.length,b=0;b<this.width;b++)if(this.cells[a-1][b]===!0)return!1;return!0}},{key:"getSize",value:function(){var a=this.cells.length;return{width:this.width,height:this.lastRowIsEmpty()?a-1:a}}}]),a}(),config:{widthSize:350,heightSize:60,depthWidthFactor:4,depthHeightFactor:2,showNumbersAll:!1},handleConnectedToNextCaseIfNecessary:function(a,b){var c,d,e=a[b],g=a[b+1];e.hasOwnProperty("connectedWithNext")===!0&&g&&(g.id?d=g.id:(d="to-next-"+String(++f.ids),g.id=d),c=_.isObject(e.connectedWithNext)&&e.connectedWithNext.type?{id:d,type:e.connectedWithNext.type}:d,e.connectedTo?e.connectedTo.push(c):e.connectedTo=[c])},itemsOfLayerShouldBeSorted:function(a){var b=!0;return _.each(a,function(a){a.hasOwnProperty("connectedTo")&&(b=!1),a.hasOwnProperty("connectToNext")&&(b=!1)}),b},calculateLayerWithChildrenDimensions:function(a){var b,c,d,e,g,h,i=0,j=0,k=0,l=0,m=[],n=0,o=function(a){return b[a].inNewRow===!0?(c.addItemAtNewRow(b[a]),b.splice(a,1),!0):c.itemFitsAtCurrentPos(b[a])?(c.addItemAtCurrentPos(b[a]),b.splice(a,1),!0):!1};for(_.each(a.items,function(a){i+=a.width,j+=a.height,l=a.height>l?a.height:l,k=a.width>k?a.width:k,m.push(a)}),e=i/2>=k?j>i?j/2<a.items.length?Math.ceil(i/2):i:Math.ceil(i/2):k,e=f.maxUnityWidth<e?f.maxUnityWidth:e,c=new f.Grid(e),h=f.itemsOfLayerShouldBeSorted(m),b=h?m.sort(function(a,b){return a.width===b.width?a.height<b.height:a.width<b.width}):m,o(0),d=0;b.length>0&&1e3>n;)o(d)?d=0:h?(d++,d===b.length&&(d=0,c.movePositionToNextRow())):c.movePositionToNextRow(),n++;g=c.getSize(),a.x=0,a.y=0,a.width=g.width,a.height=a.items.length>0?g.height+1:g.height},generateLayersData:function(a,b){var c,d,e=f.config;return b=b||1,c=b,_.each(a,function(g,h){g.showNumbersAll===!0&&(e.showNumbersAll=!0),g.depth=b,f.handleConnectedToNextCaseIfNecessary(a,h),g.items.length>0?(d=f.generateLayersData(g.items,b+1),g.maxLayerDepthBelow=d-b,f.calculateLayerWithChildrenDimensions(g),c=d>c?d:c):(g.maxLayerDepthBelow=0,g.width=1,g.height=1,c=d>c?d:c),g.alreadyConnections=[]}),c},getFinalLayerDimensions:function(a){var b=f.config,c=a.height*b.heightSize-b.depthHeightFactor*a.depth*2,d=a.width*b.widthSize-b.depthWidthFactor*a.depth*2,e="translate("+b.depthWidthFactor*a.depth+","+b.depthHeightFactor*a.depth+")",g="url(#color-"+String(a.depth-1)+")",h={height:c,width:d,transform:e,fill:g};return(b.showNumbersAll===!0||a.containerData&&a.containerData.showNumbers===!0)&&(h.numberTransform="translate("+String(d-15+b.depthWidthFactor*a.depth)+","+String(b.depthHeightFactor*a.depth+c+0)+")"),h},dataFromSpecificToGeneral:function(a){var b=-1,c=[],d=[],e=function f(a,e){_.each(a,function(a){var g,h,i,j,k=/(\. |:)/.exec(a.fullText);k&&(i=a.fullText.split(k[0]),
g=i[0],h=i.slice(1).join(k)),j={name:g||a.fullText,description:h||null,graphsData:{layer:{relationships:a.options,id:a.id}},id:++b},c.push(j),e&&d.push({from:j.id,to:e.id}),a.items&&a.items.length>0&&f(a.items,j)})};return e([a]),{items:c,connections:d}},dataFromGeneralToSpecific:function(a){return c.utils.dataFromGeneralToSpecificForATreeStructureType(a)},newLayer:function(a,b,c){var d={text:a};return _.isArray(b)?c=b:(_.isString(b)&&(b=f.extendOpts(b)),_.isObject(b)&&(d=_.extend(d,b))),c&&(d.items=c),_.isUndefined(d.id)&&(d.id="layer-"+ ++f.ids+"-auto"),d},newLayerConnectedToNext:function(){var a=arguments.length;return 1===a?f.newLayer(arguments[0],"cn"):2===a?"object"==typeof arguments[1]?f.newLayer(arguments[0],"cn",arguments[1]):f.newLayer(arguments[0],arguments[1]+" cn"):3===a?f.newLayer(arguments[0],arguments[1]+" cn",arguments[2]):void 0},staticOptsLetters:{co:{conditional:!0},cn:{connectedWithNext:!0},sna:{showNumbersAll:!0},sn:{showNumbers:!0},cnd:{connectedWithNext:{type:"dashed"}},nr:{inNewRow:!0}},idOpt:function(a){return{id:"layer-"+a+"-custom"}},extendOpts:function(){var a={};return _.each(arguments,function(b){"string"==typeof b?_.each(b.split(" "),function(b){"id-"===b.substr(0,3)?a=_.extend(a,f.idOpt(b.substr(3,b.length))):"ct-"===b.substr(0,3)?f.connectWithOpt(Number(b.substr(3,b.length)),a):"ctd-"===b.substr(0,4)?f.connectWithOpt(Number(b.substr(4,b.length)),a,"dashed"):a=_.extend(a,f.staticOptsLetters[b])}):_.isObject(b)&&(a=_.extend(a,b))}),a},connectWithOpt:function(a,b,c){var d=[];_.isNumber(a)&&(a=[a]),c=c||"standard",_.each(a,function(a){d.push({id:"layer-"+a+"-custom",type:c})}),_.isUndefined(b.connectedTo)===!0?b.connectedTo=d:b.connectedTo=b.connectedTo.concat(d)},connectWithOptAndIdOpt:function(a,c){var d=b.layer.connectWithOpt(a),e=b.layer.idOpt(c);return _.extend(d,e)}};_.each(["newLayer","newLayerConnectedToNext"],function(a){f[a+"WithCode"]=function(c){var d=b.utils.codeBlockOfLanguageFn(c);return function(){var b=arguments;return b[0]=d(b[0]),f[a].apply(this,b)}},f[a+"WithParagraphAndCode"]=function(d){var e=b.utils.codeBlockOfLanguageFn(d);return function(){var b=[].splice.call(arguments,0),d=b[0],g=b[1],h=c.utils.wrapInParagraph(d)+e(g);return b=b.splice(2),b.unshift(h),f[a].apply(this,b)}}}),new(a=function(a){function b(){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return _inherits(b,a),_createClass(b,[{key:"create",value:function(a,b){var g=this,h=f.config,i=["#ECD078","#D95B43","#C02942","#78E4B7","#53777A","#00A8C6","#AEE239","#FAAE8A"],j=function r(a){_.each(a,function(a){a.hasOwnProperty("items")===!1?a.items=[]:r(a.items)})},k=function(a,b){var c,d=function(a){return{x:(a.x+a.width/2)*h.widthSize+h.depthWidthFactor*a.depth,y:a.y*h.heightSize+h.depthHeightFactor*a.depth}},e=function(a){return{x:(a.x+a.width/2)*h.widthSize+h.depthWidthFactor*a.depth,y:(a.y+a.height)*h.heightSize-h.depthHeightFactor*a.depth}},f=function(a){return{x:a.x*h.widthSize+h.depthWidthFactor*a.depth,y:(a.y+a.height/2)*h.heightSize+h.depthHeightFactor*a.depth}},g=function(a){return{x:(a.x+a.width)*h.widthSize-h.depthWidthFactor*a.depth,y:(a.y+a.height/2)*h.heightSize+h.depthHeightFactor*a.depth}},i=function(a){return{top:d(a),bottom:e(a),left:f(a),right:g(a)}},j={val:1/0},k=function(a,b,c,d){if("bottom"!==c&&"left"!==c&&"top"!==c||"right"!==d){if("bottom"!==c&&"right"!==c&&"top"!==c||"left"!==d){if("bottom"!==c&&"right"!==c&&"left"!==c||"top"!==d){if(("left"===c||"right"===c||"top"===c)&&"bottom"===d&&a.y<b.y)return!1}else if(a.y>b.y)return!1}else if(a.x>b.x)return!1}else if(a.x<b.x)return!1;return!0},l=function(a,b){var c=function(a){return Math.pow(a,2)},d=Math.sqrt(c(a.x-b.x)+c(a.y-b.y));return d<j.val?(j.val=d,j.from=a,j.to=b,!0):!1},m=function(a){_.each(["top","bottom","left","right"],function(b){a(b)})},n=function(a,b){var c=!1;return _.each([[a,b],[b,a]],function(a){"top"===a[0]&&"bottom"===a[1]?c=!0:"left"===a[0]&&"right"===a[1]&&(c=!0)}),c},o=function(b){m(function(d){m(function(e){_.isUndefined(p.alreadyConnections)&&(p.alreadyConnections=[]),d!==e&&a.alreadyConnections.indexOf(d)<0&&p.alreadyConnections.indexOf(e)<0&&(b===!1&&n(d,e)===!1||n(d,e))&&k(q[d],r[e],d,e)&&(c=l(q[d],r[e]),c===!0&&(j.sideA=d,j.sideB=e))})})},p=b.layer,q=i(a),r=i(p);return o(!0),c!==!0&&o(!1),a.alreadyConnections.push(j.sideA),p.alreadyConnections.push(j.sideB),j},l=function(a){var b,c,d,f,g,h=a.layer.container,j=a.layer.containerData;_.each(a.connectedTo,function(l){d=k(a.layer,l),f=d3.svg.line().x(e("x")).y(e("y")),c=a.layer.id+"-"+l.layer.id,b=h.append("g").attr("id",c),d.from&&d.to&&(g=b.append("path").attr("d",f([d.from,d.to])).style({stroke:"#000",fill:"none"}),"dashed"===l.type&&g.style("stroke-dasharray","5, 5"),b.append("circle").attr({cx:d.to.x,cy:d.to.y,r:5,fill:i[a.layer.depth-1]}).style({stroke:"#000"}),j.connections=j.connections||[],j.connections.push({el:b,id:c}))})},m=function s(a){a=a||b,_.chain(a).filter(function(a){return a.hasOwnProperty("connectedTo")}).map(function(b){var c,d,e,f=[];return _.each(b.connectedTo,function(b){d=_.isObject(b)?b.id:b,e=_.isObject(b)&&b.type?b.type:"standard",c=_.where(a,{id:d})[0],f.push({layer:c,type:e})}),{layer:b,connectedTo:f}}).each(function(a){l(a)}).value(),_.chain(a).filter(function(a){return a.items.length>0}).each(function(a){s(a.items)}).value()},n=function(){var a=function(a){return a.y+a.height},c=_.max(b,a),d=a(c),e=d*h.heightSize+20;q.attr("height",e)},o=function(){var a=document.body.getBoundingClientRect().width;f.maxUnityWidth=Math.floor(a/h.widthSize)},p=function t(a,e,j){var k,l,m,n,o=h.widthSize,p=h.heightSize;a=a||b,e=e||q,_.each(a,function(a,b){var q,r="diagrams-layer-g-"+d++;k=e.append("g").attr({transform:"translate("+String(a.x*o)+", "+a.y*p+")","class":"layer-node",id:r}),a.layerG=k,a.container=e,a.containerData=j,m=f.getFinalLayerDimensions(a),l=k.append("g"),a.conditional===!0?l.append("path").attr({d:c.shapes.hexagon({height:m.height,width:m.width,widthPercent:97+Math.abs(3-a.depth)}),transform:m.transform,fill:m.fill,stroke:"#f00"}):l.append("rect").attr({width:m.width,transform:m.transform,height:m.height,fill:m.fill}).style({filter:"url(#diagrams-drop-shadow-layer)"}),n=l.append("text").attr({transform:m.transform,x:a.depth,y:a.height*p-3*a.depth-10}).text(function(){return c.utils.formatShortDescription(a.text)}),a.fullText=a.text,g.addMouseListenersToEl(l,a),n.each(c.svg.textEllipsis(a.width*o-h.depthWidthFactor*a.depth*2)),m.numberTransform&&(q=l.append("g").attr({"class":"number",transform:m.numberTransform}),q.append("circle").attr({r:10,cx:4,cy:-4,fill:i[a.depth-1],"stroke-width":2,stroke:"#000",filert:"none"}),q.append("text").text(b+1).attr("fill","#000")),a.items.length>0&&t(a.items,k,a)})},q=c.svg.generateSvg({margin:"20px 0 0 20px"});g.markRelatedFn=function(a){a.data.origFill=a.data.origFill||a.el.select("rect").style("fill"),a.el.select("rect").style({fill:"rgb(254, 255, 209)"})},g.unmarkAllItems=function(){var a=function c(a){_.each(a,function(a){a.layerG.style({"stroke-width":"1px"}),a.origFill&&a.layerG.select("rect").style("fill",a.origFill),a.items&&c(a.items)})};a(b)},_.each(i,function(a,b){c.svg.addVerticalGradientFilter(q,"color-"+b,["#fff",a])}),q.attr("class","layers-diagram"),_.isArray(b)===!1&&(b=[b]),c.svg.addFilterColor("layer",q,3,2),j(b),o(),f.generateLayersData(b),p(),m(),n(),g.generateRelationships(b)}},{key:"generateRelationships",value:function(a,b){var c=this;_.each(a,function(a){c.generateEmptyRelationships(a),c.addSelfRelationship(a,a.layerG,a),b&&(c.addDependantRelationship(b,a.layerG,a),c.addDependencyRelationship(a,b.layerG,b)),a.items&&a.items.length>0&&c.generateRelationships(a.items,a)})}}]),b}(c.Diagram))({name:"layer",helpers:f})}(),a.diagrams=b}(window);